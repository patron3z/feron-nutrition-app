{"fsPath":"\\home\\user\\workspace\\src\\api\\nutrition-ai.ts","fileUuid":"21620d24-d5e0-42e8-aece-635a6f2b617b","fileSizeBytes":25745,"numLines":663,"diffChanges":[{"originalStartLineNumberOneIndexed":3,"originalEndLineNumberExclusiveOneIndexed":3,"modifiedStartLineNumberOneIndexed":3,"modifiedEndLineNumberExclusiveOneIndexed":137,"addedLines":["","// Fonctions d'estimation intelligente des valeurs nutritionnelles","function getDefaultCaloriesForFood(foodName: string): number {","  const name = foodName.toLowerCase();","  ","  // Viandes et protéines","  if (name.includes('chicken') || name.includes('poulet')) return 165;","  if (name.includes('beef') || name.includes('bœuf') || name.includes('boeuf')) return 250;","  if (name.includes('pork') || name.includes('porc')) return 242;","  if (name.includes('fish') || name.includes('poisson') || name.includes('salmon')) return 208;","  if (name.includes('egg') || name.includes('œuf') || name.includes('oeuf')) return 155;","  ","  // Féculents","  if (name.includes('rice') || name.includes('riz')) return 130;","  if (name.includes('pasta') || name.includes('pâtes') || name.includes('pates')) return 131;","  if (name.includes('bread') || name.includes('pain')) return 265;","  if (name.includes('potato') || name.includes('pomme de terre')) return 77;","  ","  // Légumes","  if (name.includes('broccoli') || name.includes('brocoli')) return 34;","  if (name.includes('carrot') || name.includes('carotte')) return 41;","  if (name.includes('lettuce') || name.includes('salade') || name.includes('laitue')) return 15;","  if (name.includes('tomato') || name.includes('tomate')) return 18;","  ","  // Fruits","  if (name.includes('apple') || name.includes('pomme')) return 52;","  if (name.includes('banana') || name.includes('banane')) return 89;","  if (name.includes('orange')) return 47;","  ","  // Produits laitiers","  if (name.includes('cheese') || name.includes('fromage')) return 402;","  if (name.includes('milk') || name.includes('lait')) return 42;","  if (name.includes('yogurt') || name.includes('yaourt')) return 59;","  ","  // Plats préparés","  if (name.includes('pizza')) return 266;","  if (name.includes('burger') || name.includes('hamburger')) return 295;","  if (name.includes('sandwich')) return 250;","  ","  // Valeur par défaut plus réaliste","  return 180;","}","","function getDefaultProteinForFood(foodName: string): number {","  const name = foodName.toLowerCase();","  ","  // Viandes et protéines","  if (name.includes('chicken') || name.includes('poulet')) return 31;","  if (name.includes('beef') || name.includes('bœuf') || name.includes('boeuf')) return 26;","  if (name.includes('pork') || name.includes('porc')) return 27;","  if (name.includes('fish') || name.includes('poisson') || name.includes('salmon')) return 25;","  if (name.includes('egg') || name.includes('œuf') || name.includes('oeuf')) return 13;","  ","  // Féculents","  if (name.includes('rice') || name.includes('riz')) return 2.7;","  if (name.includes('pasta') || name.includes('pâtes') || name.includes('pates')) return 5;","  if (name.includes('bread') || name.includes('pain')) return 9;","  if (name.includes('potato') || name.includes('pomme de terre')) return 2;","  ","  // Légumes","  if (name.includes('broccoli') || name.includes('brocoli')) return 2.8;","  if (name.includes('carrot') || name.includes('carotte')) return 0.9;","  if (name.includes('lettuce') || name.includes('salade') || name.includes('laitue')) return 1.4;","  if (name.includes('tomato') || name.includes('tomate')) return 0.9;","  ","  // Produits laitiers","  if (name.includes('cheese') || name.includes('fromage')) return 25;","  if (name.includes('milk') || name.includes('lait')) return 3.4;","  if (name.includes('yogurt') || name.includes('yaourt')) return 10;","  ","  // Valeur par défaut","  return 8;","}","","function getDefaultCarbsForFood(foodName: string): number {","  const name = foodName.toLowerCase();","  ","  // Viandes et protéines","  if (name.includes('chicken') || name.includes('poulet') || ","      name.includes('beef') || name.includes('pork') || ","      name.includes('fish') || name.includes('poisson')) return 0;","  if (name.includes('egg') || name.includes('œuf') || name.includes('oeuf')) return 1.1;","  ","  // Féculents","  if (name.includes('rice') || name.includes('riz')) return 28;","  if (name.includes('pasta') || name.includes('pâtes') || name.includes('pates')) return 25;","  if (name.includes('bread') || name.includes('pain')) return 49;","  if (name.includes('potato') || name.includes('pomme de terre')) return 17;","  ","  // Légumes","  if (name.includes('broccoli') || name.includes('brocoli')) return 7;","  if (name.includes('carrot') || name.includes('carotte')) return 10;","  if (name.includes('lettuce') || name.includes('salade') || name.includes('laitue')) return 3;","  if (name.includes('tomato') || name.includes('tomate')) return 3.9;","  ","  // Fruits","  if (name.includes('apple') || name.includes('pomme')) return 14;","  if (name.includes('banana') || name.includes('banane')) return 23;","  if (name.includes('orange')) return 12;","  ","  // Valeur par défaut","  return 15;","}","","function getDefaultFatForFood(foodName: string): number {","  const name = foodName.toLowerCase();","  ","  // Viandes et protéines","  if (name.includes('chicken') || name.includes('poulet')) return 3.6;","  if (name.includes('beef') || name.includes('bœuf') || name.includes('boeuf')) return 15;","  if (name.includes('pork') || name.includes('porc')) return 14;","  if (name.includes('fish') || name.includes('poisson') || name.includes('salmon')) return 13;","  if (name.includes('egg') || name.includes('œuf') || name.includes('oeuf')) return 11;","  ","  // Féculents","  if (name.includes('rice') || name.includes('riz')) return 0.3;","  if (name.includes('pasta') || name.includes('pâtes') || name.includes('pates')) return 1.1;","  if (name.includes('bread') || name.includes('pain')) return 3.2;","  if (name.includes('potato') || name.includes('pomme de terre')) return 0.1;","  ","  // Légumes et fruits","  if (name.includes('broccoli') || name.includes('carrot') || ","      name.includes('lettuce') || name.includes('tomato') ||","      name.includes('apple') || name.includes('orange')) return 0.3;","  if (name.includes('banana') || name.includes('banane')) return 0.3;","  ","  // Produits laitiers","  if (name.includes('cheese') || name.includes('fromage')) return 33;","  if (name.includes('milk') || name.includes('lait')) return 1;","  if (name.includes('yogurt') || name.includes('yaourt')) return 0.4;","  ","  // Valeur par défaut","  return 5;","}"],"tokenizedAddedLines":[3,1000369,1000370,1000371,94,1000372,1000373,1000374,1000375,1000376,1000377,94,1000378,1000379,1000380,1000381,1000382,94,1000383,1000384,1000385,1000386,1000387,94,1000388,1000389,1000390,1000391,94,1000392,1000393,1000394,1000395,94,1000396,1000397,1000398,1000399,94,1000400,1000401,8,3,1000402,1000371,94,1000372,1000403,1000404,1000405,1000406,1000407,94,1000378,1000408,1000409,1000410,1000411,94,1000383,1000412,1000413,1000414,1000415,94,1000392,1000416,1000417,1000418,94,1000419,1000420,8,3,1000421,1000371,94,1000372,1000422,1000423,1000424,1000425,94,1000378,1000426,1000427,1000428,1000429,94,1000383,1000430,1000431,1000432,1000433,94,1000388,1000434,1000435,1000436,94,1000419,1000437,8,3,1000438,1000371,94,1000372,1000439,1000440,1000441,1000442,1000443,94,1000378,1000444,1000445,1000446,1000447,94,1000448,1000449,1000450,1000451,1000452,94,1000392,1000453,1000454,1000455,94,1000419,1000456,8]},{"originalStartLineNumberOneIndexed":297,"originalEndLineNumberExclusiveOneIndexed":300,"modifiedStartLineNumberOneIndexed":431,"modifiedEndLineNumberExclusiveOneIndexed":432,"addedLines":["          const estimatePrompt = `Provide realistic nutritional information for \"${foodName}\" per 100g in JSON format: {\"calories\": number, \"protein\": number, \"carbs\": number, \"fat\": number, \"fiber\": number, \"sugar\": number, \"sodium\": number}. Be accurate based on the food type.`;"],"tokenizedAddedLines":[1000457]},{"originalStartLineNumberOneIndexed":302,"originalEndLineNumberExclusiveOneIndexed":302,"modifiedStartLineNumberOneIndexed":434,"modifiedEndLineNumberExclusiveOneIndexed":435,"addedLines":["            const geminiNutrition = await generateContent(estimatePrompt);"],"tokenizedAddedLines":[1000458]},{"originalStartLineNumberOneIndexed":304,"originalEndLineNumberExclusiveOneIndexed":304,"modifiedStartLineNumberOneIndexed":437,"modifiedEndLineNumberExclusiveOneIndexed":443,"addedLines":["            ","            // Utiliser les valeurs Gemini ou des valeurs par défaut améliorées","            const baseCalories = nutritionData.calories || getDefaultCaloriesForFood(foodName);","            const baseProtein = nutritionData.protein || getDefaultProteinForFood(foodName);","            const baseCarbs = nutritionData.carbs || getDefaultCarbsForFood(foodName);","            const baseFat = nutritionData.fat || getDefaultFatForFood(foodName);"],"tokenizedAddedLines":[245,1000459,1000460,1000461,1000462,1000463]},{"originalStartLineNumberOneIndexed":308,"originalEndLineNumberExclusiveOneIndexed":315,"modifiedStartLineNumberOneIndexed":447,"modifiedEndLineNumberExclusiveOneIndexed":454,"addedLines":["              calories: baseCalories * scale,","              protein: baseProtein * scale,","              carbs: baseCarbs * scale,","              fat: baseFat * scale,","              fiber: (nutritionData.fiber || 2) * scale,","              sugar: (nutritionData.sugar || 5) * scale,","              sodium: (nutritionData.sodium || 50) * scale,"],"tokenizedAddedLines":[1000464,1000465,1000466,1000467,1000468,1000469,1000470]},{"originalStartLineNumberOneIndexed":320,"originalEndLineNumberExclusiveOneIndexed":321,"modifiedStartLineNumberOneIndexed":459,"modifiedEndLineNumberExclusiveOneIndexed":460,"addedLines":["            console.log(`✅ Gemini estimation avec échelle ${scale}x pour ${foodName}: ${(baseCalories * scale).toFixed(0)}kcal`);"],"tokenizedAddedLines":[1000471]},{"originalStartLineNumberOneIndexed":322,"originalEndLineNumberExclusiveOneIndexed":323,"modifiedStartLineNumberOneIndexed":461,"modifiedEndLineNumberExclusiveOneIndexed":463,"addedLines":["            console.warn('Erreur parsing Gemini nutrition, utilisation des valeurs par défaut améliorées:', parseError);","            const defaultCalories = getDefaultCaloriesForFood(foodName);"],"tokenizedAddedLines":[1000472,1000473]},{"originalStartLineNumberOneIndexed":326,"originalEndLineNumberExclusiveOneIndexed":330,"modifiedStartLineNumberOneIndexed":466,"modifiedEndLineNumberExclusiveOneIndexed":470,"addedLines":["              calories: defaultCalories * scale,","              protein: getDefaultProteinForFood(foodName) * scale,","              carbs: getDefaultCarbsForFood(foodName) * scale,","              fat: getDefaultFatForFood(foodName) * scale,"],"tokenizedAddedLines":[1000474,1000475,1000476,1000477]},{"originalStartLineNumberOneIndexed":331,"originalEndLineNumberExclusiveOneIndexed":332,"modifiedStartLineNumberOneIndexed":471,"modifiedEndLineNumberExclusiveOneIndexed":472,"addedLines":["              sugar: 5 * scale,"],"tokenizedAddedLines":[1000478]},{"originalStartLineNumberOneIndexed":334,"originalEndLineNumberExclusiveOneIndexed":335,"modifiedStartLineNumberOneIndexed":474,"modifiedEndLineNumberExclusiveOneIndexed":475,"addedLines":["              brand: \"Estimation intelligente\","],"tokenizedAddedLines":[1000479]},{"originalStartLineNumberOneIndexed":338,"originalEndLineNumberExclusiveOneIndexed":338,"modifiedStartLineNumberOneIndexed":478,"modifiedEndLineNumberExclusiveOneIndexed":479,"addedLines":["            console.log(`✅ Fallback intelligent avec échelle ${scale}x pour ${foodName}: ${(defaultCalories * scale).toFixed(0)}kcal`);"],"tokenizedAddedLines":[1000480]},{"originalStartLineNumberOneIndexed":347,"originalEndLineNumberExclusiveOneIndexed":347,"modifiedStartLineNumberOneIndexed":488,"modifiedEndLineNumberExclusiveOneIndexed":490,"addedLines":["    const fallbackName = description || \"Aliment scanné\";","    const fallbackCalories = getDefaultCaloriesForFood(fallbackName);"],"tokenizedAddedLines":[1000481,1000482]},{"originalStartLineNumberOneIndexed":350,"originalEndLineNumberExclusiveOneIndexed":355,"modifiedStartLineNumberOneIndexed":493,"modifiedEndLineNumberExclusiveOneIndexed":498,"addedLines":["        name: fallbackName,","        calories: fallbackCalories,","        protein: getDefaultProteinForFood(fallbackName),","        carbs: getDefaultCarbsForFood(fallbackName),","        fat: getDefaultFatForFood(fallbackName),"],"tokenizedAddedLines":[1000483,1000484,1000485,1000486,1000487]},{"originalStartLineNumberOneIndexed":356,"originalEndLineNumberExclusiveOneIndexed":357,"modifiedStartLineNumberOneIndexed":499,"modifiedEndLineNumberExclusiveOneIndexed":500,"addedLines":["        sugar: 5,"],"tokenizedAddedLines":[82]},{"originalStartLineNumberOneIndexed":358,"originalEndLineNumberExclusiveOneIndexed":360,"modifiedStartLineNumberOneIndexed":501,"modifiedEndLineNumberExclusiveOneIndexed":503,"addedLines":["        servingSize: \"estimation intelligente\",","        brand: \"Estimation intelligente\","],"tokenizedAddedLines":[1000488,1000489]},{"originalStartLineNumberOneIndexed":363,"originalEndLineNumberExclusiveOneIndexed":365,"modifiedStartLineNumberOneIndexed":506,"modifiedEndLineNumberExclusiveOneIndexed":508,"addedLines":["      confidence: 0.4,","      suggestions: [\"Estimation basée sur le type d'aliment - vérifiez si nécessaire\"]"],"tokenizedAddedLines":[1000490,1000491]},{"originalStartLineNumberOneIndexed":384,"originalEndLineNumberExclusiveOneIndexed":384,"modifiedStartLineNumberOneIndexed":527,"modifiedEndLineNumberExclusiveOneIndexed":529,"addedLines":["    const fallbackName = description || \"Aliment scanné\";","    const fallbackCalories = getDefaultCaloriesForFood(fallbackName);"],"tokenizedAddedLines":[1000481,1000482]},{"originalStartLineNumberOneIndexed":387,"originalEndLineNumberExclusiveOneIndexed":392,"modifiedStartLineNumberOneIndexed":532,"modifiedEndLineNumberExclusiveOneIndexed":537,"addedLines":["        name: fallbackName,","        calories: fallbackCalories,","        protein: getDefaultProteinForFood(fallbackName),","        carbs: getDefaultCarbsForFood(fallbackName),","        fat: getDefaultFatForFood(fallbackName),"],"tokenizedAddedLines":[1000483,1000484,1000485,1000486,1000487]},{"originalStartLineNumberOneIndexed":393,"originalEndLineNumberExclusiveOneIndexed":394,"modifiedStartLineNumberOneIndexed":538,"modifiedEndLineNumberExclusiveOneIndexed":539,"addedLines":["        sugar: 5,"],"tokenizedAddedLines":[82]},{"originalStartLineNumberOneIndexed":395,"originalEndLineNumberExclusiveOneIndexed":397,"modifiedStartLineNumberOneIndexed":540,"modifiedEndLineNumberExclusiveOneIndexed":542,"addedLines":["        servingSize: \"estimation intelligente\",","        brand: \"Estimation intelligente\""],"tokenizedAddedLines":[1000488,1000492]},{"originalStartLineNumberOneIndexed":398,"originalEndLineNumberExclusiveOneIndexed":400,"modifiedStartLineNumberOneIndexed":543,"modifiedEndLineNumberExclusiveOneIndexed":545,"addedLines":["      confidence: 0.4,","      suggestions: [\"Estimation basée sur le type d'aliment - vérifiez si nécessaire\"]"],"tokenizedAddedLines":[1000490,1000491]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_MODIFIED"}